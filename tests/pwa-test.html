<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1FC7D4">
    <title>PWA ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ - ê°ìí† ë¼ ê°€ê³„ë¶€</title>
    <link rel="manifest" href="../manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Kanit', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(139.73deg, #E5FDFF 0%, #F3EFFF 100%);
            color: #280D5F;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .title {
            font-size: 2rem;
            font-weight: 700;
            color: #1FC7D4;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: #7A6EAA;
        }
        
        .test-section {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1FC7D4;
            margin-bottom: 1rem;
        }
        
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid #EFF4F5;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .test-name {
            font-weight: 500;
        }
        
        .test-status {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-pass {
            background: #E8F5E8;
            color: #0E7A5D;
        }
        
        .status-fail {
            background: #FFEBF0;
            color: #C42878;
        }
        
        .status-pending {
            background: #FFF5E6;
            color: #D67E0A;
        }
        
        .test-button {
            background: #1FC7D4;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            display: inline-block;
        }
        
        .test-button:hover {
            background: #0098A1;
        }
        
        .test-button:disabled {
            background: #BDC2C4;
            cursor: not-allowed;
        }
        
        .test-results {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .theme-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .install-prompt {
            background: #FFB237;
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            display: none;
        }
        
        .install-button {
            background: white;
            color: #FFB237;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            font-weight: 500;
            cursor: pointer;
            margin-top: 0.5rem;
        }
        
        @media (prefers-color-scheme: dark) {
            body {
                background: #0E0E0E;
                color: #FFFFFF;
            }
            
            .test-section {
                background: #1A1A1A;
                border: 1px solid #333;
            }
            
            .test-item {
                border-color: #333;
            }
            
            .section-title {
                color: #33E1ED;
            }
            
            .test-button {
                background: #33E1ED;
                color: #0E0E0E;
            }
            
            .test-button:hover {
                background: #1FC7D4;
            }
        }
    </style>
</head>
<body>
    <!-- PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ -->
    <div class="install-prompt" id="installPrompt">
        <div>ğŸ¥”ğŸ° ê°ìí† ë¼ ê°€ê³„ë¶€ë¥¼ í™ˆ í™”ë©´ì— ì„¤ì¹˜í•˜ì„¸ìš”!</div>
        <button class="install-button" id="installButton">ì•± ì„¤ì¹˜</button>
    </div>
    
    <div class="container">
        <div class="header">
            <h1 class="title">PWA ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>
            <p class="subtitle">ê°ìí† ë¼ ê°€ê³„ë¶€ Progressive Web App ê²€ì¦</p>
        </div>
        
        <!-- ê¸°ë³¸ PWA ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2 class="section-title">ğŸ“± ê¸°ë³¸ PWA ê¸°ëŠ¥</h2>
            
            <div class="test-item">
                <span class="test-name">Service Worker ë“±ë¡</span>
                <span class="test-status status-pending" id="swStatus">ëŒ€ê¸° ì¤‘</span>
            </div>
            
            <div class="test-item">
                <span class="test-name">Manifest íŒŒì¼ ë¡œë“œ</span>
                <span class="test-status status-pending" id="manifestStatus">ëŒ€ê¸° ì¤‘</span>
            </div>
            
            <div class="test-item">
                <span class="test-name">ì•± ì„¤ì¹˜ ê°€ëŠ¥ì„±</span>
                <span class="test-status status-pending" id="installStatus">ëŒ€ê¸° ì¤‘</span>
            </div>
            
            <div class="test-item">
                <span class="test-name">ì˜¤í”„ë¼ì¸ ë™ì‘</span>
                <span class="test-status status-pending" id="offlineStatus">ëŒ€ê¸° ì¤‘</span>
            </div>
            
            <button class="test-button" onclick="runBasicTests()">ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        </div>
        
        <!-- í…Œë§ˆ ë™ê¸°í™” í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2 class="section-title">ğŸ¨ í…Œë§ˆ ë™ê¸°í™” í…ŒìŠ¤íŠ¸</h2>
            
            <div class="test-item">
                <span class="test-name">Meta Theme Color ì—…ë°ì´íŠ¸</span>
                <span class="test-status status-pending" id="themeColorStatus">ëŒ€ê¸° ì¤‘</span>
            </div>
            
            <div class="test-item">
                <span class="test-name">ë™ì  Manifest ìƒì„±</span>
                <span class="test-status status-pending" id="dynamicManifestStatus">ëŒ€ê¸° ì¤‘</span>
            </div>
            
            <div class="theme-controls">
                <button class="test-button" onclick="testTheme('light')">ë¼ì´íŠ¸ í…Œë§ˆ</button>
                <button class="test-button" onclick="testTheme('dark')">ë‹¤í¬ í…Œë§ˆ</button>
                <button class="test-button" onclick="testTheme('hc')">ê³ ëŒ€ë¹„ í…Œë§ˆ</button>
            </div>
        </div>
        
        <!-- ìºì‹œ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2 class="section-title">ğŸ’¾ ìºì‹œ í…ŒìŠ¤íŠ¸</h2>
            
            <div class="test-item">
                <span class="test-name">í•µì‹¬ ë¦¬ì†ŒìŠ¤ ìºì‹œ</span>
                <span class="test-status status-pending" id="cacheStatus">ëŒ€ê¸° ì¤‘</span>
            </div>
            
            <div class="test-item">
                <span class="test-name">ìºì‹œ í¬ê¸°</span>
                <span class="test-status status-pending" id="cacheSizeStatus">ì¸¡ì • ì¤‘</span>
            </div>
            
            <button class="test-button" onclick="testCache()">ìºì‹œ í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="clearCache()">ìºì‹œ ì‚­ì œ</button>
        </div>
        
        <!-- ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2 class="section-title">âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
            
            <div class="test-item">
                <span class="test-name">í˜ì´ì§€ ë¡œë“œ ì‹œê°„</span>
                <span class="test-status status-pending" id="loadTimeStatus">ì¸¡ì • ì¤‘</span>
            </div>
            
            <div class="test-item">
                <span class="test-name">First Contentful Paint</span>
                <span class="test-status status-pending" id="fcpStatus">ì¸¡ì • ì¤‘</span>
            </div>
            
            <div class="test-item">
                <span class="test-name">Largest Contentful Paint</span>
                <span class="test-status status-pending" id="lcpStatus">ì¸¡ì • ì¤‘</span>
            </div>
            
            <button class="test-button" onclick="measurePerformance()">ì„±ëŠ¥ ì¸¡ì •</button>
        </div>
        
        <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì¶œë ¥ -->
        <div class="test-section">
            <h2 class="section-title">ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
            <div class="test-results" id="testResults">í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
    </div>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let deferredPrompt = null;
        let testResults = document.getElementById('testResults');
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            initializeTests();
            measureInitialPerformance();
        });
        
        // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì´ë²¤íŠ¸
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
            updateStatus('installStatus', 'pass', 'ì„¤ì¹˜ ê°€ëŠ¥');
        });
        
        // ì•± ì„¤ì¹˜ ë²„íŠ¼ í´ë¦­
        document.getElementById('installButton').addEventListener('click', () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        log('ì‚¬ìš©ìê°€ PWA ì„¤ì¹˜ë¥¼ í—ˆìš©í–ˆìŠµë‹ˆë‹¤');
                        document.getElementById('installPrompt').style.display = 'none';
                    } else {
                        log('ì‚¬ìš©ìê°€ PWA ì„¤ì¹˜ë¥¼ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤');
                    }
                    deferredPrompt = null;
                });
            }
        });
        
        // í…ŒìŠ¤íŠ¸ ì´ˆê¸°í™”
        function initializeTests() {
            log('PWA ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            // Service Worker ìƒíƒœ í™•ì¸
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistration().then(registration => {
                    if (registration) {
                        updateStatus('swStatus', 'pass', 'ë“±ë¡ë¨');
                        log('âœ… Service Workerê°€ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤');
                    } else {
                        updateStatus('swStatus', 'fail', 'ë¯¸ë“±ë¡');
                        log('âŒ Service Workerê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                    }
                });
            } else {
                updateStatus('swStatus', 'fail', 'ì§€ì› ì•ˆí•¨');
                log('âŒ Service Workerë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤');
            }
            
            // Manifest í™•ì¸
            fetch('/manifest.json')
                .then(response => {
                    if (response.ok) {
                        updateStatus('manifestStatus', 'pass', 'ë¡œë“œ ì„±ê³µ');
                        return response.json();
                    } else {
                        throw new Error('Manifest ë¡œë“œ ì‹¤íŒ¨');
                    }
                })
                .then(manifest => {
                    log(`âœ… Manifest ë¡œë“œ ì„±ê³µ: ${manifest.name}`);
                })
                .catch(error => {
                    updateStatus('manifestStatus', 'fail', 'ë¡œë“œ ì‹¤íŒ¨');
                    log(`âŒ Manifest ì˜¤ë¥˜: ${error.message}`);
                });
        }
        
        // ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function runBasicTests() {
            log('ê¸°ë³¸ PWA í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...');
            
            // ì˜¤í”„ë¼ì¸ í…ŒìŠ¤íŠ¸
            await testOfflineCapability();
        }
        
        // ì˜¤í”„ë¼ì¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
        async function testOfflineCapability() {
            try {
                // Service Workerê°€ ìºì‹œëœ ë¦¬ì†ŒìŠ¤ë¥¼ ì œê³µí•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸
                const testUrl = '/css/tokens.css';
                const response = await fetch(testUrl);
                
                if (response.ok) {
                    updateStatus('offlineStatus', 'pass', 'ìºì‹œ ë™ì‘');
                    log('âœ… ì˜¤í”„ë¼ì¸ ë¦¬ì†ŒìŠ¤ ë¡œë“œ ê°€ëŠ¥');
                } else {
                    updateStatus('offlineStatus', 'fail', 'ìºì‹œ ì‹¤íŒ¨');
                    log('âŒ ìºì‹œëœ ë¦¬ì†ŒìŠ¤ ë¡œë“œ ì‹¤íŒ¨');
                }
            } catch (error) {
                updateStatus('offlineStatus', 'fail', 'ì˜¤ë¥˜');
                log(`âŒ ì˜¤í”„ë¼ì¸ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`);
            }
        }
        
        // í…Œë§ˆ ë™ê¸°í™” í…ŒìŠ¤íŠ¸
        function testTheme(theme) {
            log(`í…Œë§ˆ ë³€ê²½ í…ŒìŠ¤íŠ¸: ${theme}`);
            
            // í…Œë§ˆ ìƒ‰ìƒ ì •ì˜
            const themeColors = {
                light: { themeColor: '#1FC7D4', name: 'ë¼ì´íŠ¸' },
                dark: { themeColor: '#33E1ED', name: 'ë‹¤í¬' },
                hc: { themeColor: '#0066CC', name: 'ê³ ëŒ€ë¹„' }
            };
            
            const color = themeColors[theme];
            if (!color) return;
            
            // Meta theme-color ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
            const metaThemeColor = document.querySelector('meta[name="theme-color"]');
            if (metaThemeColor) {
                metaThemeColor.content = color.themeColor;
                updateStatus('themeColorStatus', 'pass', `${color.name} ì ìš©`);
                log(`âœ… Theme Color ì—…ë°ì´íŠ¸: ${color.themeColor}`);
            } else {
                updateStatus('themeColorStatus', 'fail', 'Meta íƒœê·¸ ì—†ìŒ');
            }
            
            // ë™ì  ë§¤ë‹ˆí˜ìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸
            testDynamicManifest(theme, color);
        }
        
        // ë™ì  ë§¤ë‹ˆí˜ìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸
        function testDynamicManifest(theme, color) {
            try {
                // ê¸°ì¡´ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë§í¬ ì°¾ê¸°
                let manifestLink = document.querySelector('link[rel="manifest"]');
                if (!manifestLink) {
                    manifestLink = document.createElement('link');
                    manifestLink.rel = 'manifest';
                    document.head.appendChild(manifestLink);
                }
                
                // ë™ì  ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
                const manifestData = {
                    name: "ê°ìí† ë¼ ê°€ê³„ë¶€",
                    short_name: "ê°ìí† ë¼",
                    theme_color: color.themeColor,
                    background_color: theme === 'dark' ? '#0E0E0E' : '#FAF9FA'
                };
                
                // Blob URL ìƒì„±
                const manifestBlob = new Blob([JSON.stringify(manifestData, null, 2)], {
                    type: 'application/json'
                });
                const manifestUrl = URL.createObjectURL(manifestBlob);
                
                // ì´ì „ URL ì •ë¦¬
                if (manifestLink.dataset.prevUrl) {
                    URL.revokeObjectURL(manifestLink.dataset.prevUrl);
                }
                
                manifestLink.href = manifestUrl;
                manifestLink.dataset.prevUrl = manifestUrl;
                
                updateStatus('dynamicManifestStatus', 'pass', `${color.name} ë§¤ë‹ˆí˜ìŠ¤íŠ¸`);
                log(`âœ… ë™ì  ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ìƒì„±: ${theme}`);
                
            } catch (error) {
                updateStatus('dynamicManifestStatus', 'fail', 'ìƒì„± ì‹¤íŒ¨');
                log(`âŒ ë™ì  ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`);
            }
        }
        
        // ìºì‹œ í…ŒìŠ¤íŠ¸
        async function testCache() {
            log('ìºì‹œ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì¤‘...');
            
            try {
                const cacheNames = await caches.keys();
                if (cacheNames.length > 0) {
                    updateStatus('cacheStatus', 'pass', `${cacheNames.length}ê°œ ìºì‹œ`);
                    log(`âœ… ìºì‹œ ë°œê²¬: ${cacheNames.join(', ')}`);
                    
                    // ìºì‹œ í¬ê¸° ê³„ì‚°
                    let totalSize = 0;
                    for (const cacheName of cacheNames) {
                        const cache = await caches.open(cacheName);
                        const requests = await cache.keys();
                        totalSize += requests.length;
                    }
                    
                    updateStatus('cacheSizeStatus', 'pass', `${totalSize}ê°œ í•­ëª©`);
                    log(`ğŸ“Š ì´ ìºì‹œ í•­ëª©: ${totalSize}ê°œ`);
                    
                } else {
                    updateStatus('cacheStatus', 'fail', 'ìºì‹œ ì—†ìŒ');
                    updateStatus('cacheSizeStatus', 'fail', '0ê°œ í•­ëª©');
                    log('âŒ ìºì‹œê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                }
                
            } catch (error) {
                updateStatus('cacheStatus', 'fail', 'ì˜¤ë¥˜');
                log(`âŒ ìºì‹œ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`);
            }
        }
        
        // ìºì‹œ ì‚­ì œ
        async function clearCache() {
            try {
                const cacheNames = await caches.keys();
                await Promise.all(cacheNames.map(name => caches.delete(name)));
                
                updateStatus('cacheStatus', 'pending', 'ì‚­ì œë¨');
                updateStatus('cacheSizeStatus', 'pending', '0ê°œ í•­ëª©');
                log('ğŸ—‘ï¸ ëª¨ë“  ìºì‹œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                
            } catch (error) {
                log(`âŒ ìºì‹œ ì‚­ì œ ì˜¤ë¥˜: ${error.message}`);
            }
        }
        
        // ì´ˆê¸° ì„±ëŠ¥ ì¸¡ì •
        function measureInitialPerformance() {
            if ('performance' in window && 'timing' in performance) {
                const timing = performance.timing;
                const loadTime = timing.loadEventEnd - timing.navigationStart;
                
                updateStatus('loadTimeStatus', loadTime < 3000 ? 'pass' : 'fail', `${loadTime}ms`);
                log(`ğŸ“Š í˜ì´ì§€ ë¡œë“œ ì‹œê°„: ${loadTime}ms`);
            }
        }
        
        // ì„±ëŠ¥ ì¸¡ì • (Performance Observer ì‚¬ìš©)
        function measurePerformance() {
            log('ì„±ëŠ¥ ì¸¡ì • ì‹œì‘...');
            
            if ('PerformanceObserver' in window) {
                // First Contentful Paint ì¸¡ì •
                const observer = new PerformanceObserver((list) => {
                    for (const entry of list.getEntries()) {
                        if (entry.name === 'first-contentful-paint') {
                            const fcp = Math.round(entry.startTime);
                            updateStatus('fcpStatus', fcp < 1500 ? 'pass' : 'fail', `${fcp}ms`);
                            log(`ğŸ“Š First Contentful Paint: ${fcp}ms`);
                        }
                        
                        if (entry.entryType === 'largest-contentful-paint') {
                            const lcp = Math.round(entry.startTime);
                            updateStatus('lcpStatus', lcp < 2500 ? 'pass' : 'fail', `${lcp}ms`);
                            log(`ğŸ“Š Largest Contentful Paint: ${lcp}ms`);
                        }
                    }
                });
                
                observer.observe({ entryTypes: ['paint', 'largest-contentful-paint'] });
                
                // 3ì´ˆ í›„ observer ì •ë¦¬
                setTimeout(() => observer.disconnect(), 3000);
                
            } else {
                log('âŒ Performance Observerë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤');
            }
        }
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸ í—¬í¼
        function updateStatus(elementId, status, text) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `test-status status-${status}`;
                element.textContent = text;
            }
        }
        
        // ë¡œê·¸ ì¶œë ¥ í—¬í¼
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            testResults.textContent += `[${timestamp}] ${message}\n`;
            testResults.scrollTop = testResults.scrollHeight;
            console.log(message);
        }
    </script>
</body>
</html>