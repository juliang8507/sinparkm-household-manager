<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#1FC7D4">
    <meta name="color-scheme" content="light dark">
    <title>Í±∞Îûò Îì±Î°ù - Í∞êÏûêÌÜ†ÎÅº Í∞ÄÍ≥ÑÎ∂Ä</title>
    <meta name="description" content="Í∞êÏûêÏôÄ ÌÜ†ÎÅº ÌÖåÎßàÏùò ÏπúÍ∑ºÌïú Í±∞Îûò Îì±Î°ù ÌéòÏù¥ÏßÄ">
    
    <!-- Performance Hints -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="preload" href="icons.svg" as="image" type="image/svg+xml">
    <link rel="preload" href="transaction-form.css" as="style">
    <link rel="preload" href="transaction-form.js" as="script">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600;700&family=Nunito:wght@400;500;600;700&family=Inter:wght@400;500;600&family=Comic+Neue:wght@400;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600;700&family=Nunito:wght@400;500;600;700&family=Inter:wght@400;500;600&family=Comic+Neue:wght@400;700&display=swap"></noscript>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/tokens.css">
    <link rel="stylesheet" href="css/accessibility.css">
    <link rel="stylesheet" href="css/token-integration.css">
    <link rel="stylesheet" href="css/icon-system.css">
    <link rel="stylesheet" href="css/svg-sprite-animations.css">
    <link rel="stylesheet" href="css/theme-switcher.css">
    <link rel="stylesheet" href="transaction-form.css">
</head>
<body>
    <!-- Skip to Content -->
    <a href="#main-content" class="skip-to-content">Î©îÏù∏ ÏΩòÌÖêÏ∏†Î°ú Í±¥ÎÑàÎõ∞Í∏∞</a>
    <!-- Navigation Header -->
    <header class="page-header" role="banner">
        <div class="container">
            <div class="header-content">
                <button class="back-button" aria-label="Îí§Î°ú Í∞ÄÍ∏∞" title="Îí§Î°ú Í∞ÄÍ∏∞">
                    <span class="icon icon-sm back-icon">
                        <svg aria-hidden="true">
                            <use xlink:href="#rabbit-neutral"></use>
                        </svg>
                    </span>
                </button>
                
                <h1 class="page-title">
                    <span class="icon icon-sm title-icon">
                        <svg aria-hidden="true">
                            <use xlink:href="#potato-neutral"></use>
                        </svg>
                    </span>
                    Í±∞Îûò Îì±Î°ù
                </h1>
            </div>
            
            <!-- User Toggle -->
            <div class="user-toggle" role="group" aria-label="ÏÇ¨Ïö©Ïûê ÏÑ†ÌÉù">
                <button class="toggle-button active btn btn-sm transition-button" data-user="husband" aria-pressed="true">
                    <span class="user-icon">üë®</span>
                    <span class="user-label">ÎÇ®Ìé∏</span>
                </button>
                <button class="toggle-button btn btn-sm transition-button" data-user="wife" aria-pressed="false">
                    <span class="user-icon">üë©</span>
                    <span class="user-label">ÏïÑÎÇ¥</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="main-content" role="main">
        <div class="container">
            <form class="transaction-form" id="transactionForm" novalidate>
                
                <!-- Character Section -->
                <section class="character-section" aria-label="Ï∫êÎ¶≠ÌÑ∞ ÏïàÎÇ¥">
                    <div class="character-container">
                        <div class="character neutral" id="formCharacter">
                            <span class="icon icon-2xl character-icon">
                                <svg aria-hidden="true">
                                    <use xlink:href="#potato-neutral"></use>
                                </svg>
                            </span>
                        </div>
                        <div class="speech-bubble" id="speechBubble">
                            <span class="bubble-text">Ïñ¥Îñ§ Í±∞ÎûòÎ•º Ï∂îÍ∞ÄÌï†ÍπåÏöî?</span>
                            <div class="bubble-tail"></div>
                        </div>
                    </div>
                </section>

                <!-- Transaction Type Toggle -->
                <section class="transaction-toggle-section">
                    <h2 class="visually-hidden">Í±∞Îûò Ïú†Ìòï ÏÑ†ÌÉù</h2>
                    <div class="transaction-toggle" role="group" aria-label="ÏàòÏûÖ ÎòêÎäî ÏßÄÏ∂ú ÏÑ†ÌÉù">
                        <button type="button" class="toggle-option expense active btn btn-md transition-button" data-type="expense" aria-pressed="true">
                            <span class="icon icon-md toggle-icon character-icon">
                                <svg aria-hidden="true">
                                    <use xlink:href="#potato-warning"></use>
                                </svg>
                            </span>
                            <span class="toggle-label">ÏßÄÏ∂ú</span>
                        </button>
                        <button type="button" class="toggle-option income btn btn-md transition-button" data-type="income" aria-pressed="false">
                            <span class="icon icon-md toggle-icon character-icon">
                                <svg aria-hidden="true">
                                    <use xlink:href="#rabbit-success"></use>
                                </svg>
                            </span>
                            <span class="toggle-label">ÏàòÏûÖ</span>
                        </button>
                    </div>
                </section>

                <!-- Amount Input Section -->
                <section class="amount-section">
                    <h2 class="section-title visually-hidden">Í∏àÏï° ÏûÖÎ†•</h2>
                    <div class="amount-container">
                        <label class="currency-symbol" for="amountInput" aria-label="Ïõê">‚Ç©</label>
                        <input 
                            type="number" 
                            id="amountInput" 
                            class="amount-input input" 
                            placeholder="0" 
                            min="0" 
                            max="999999999"
                            step="1"
                            aria-label="Í±∞Îûò Í∏àÏï°"
                            aria-describedby="amountError"
                            aria-required="true"
                            autocomplete="off"
                        >
                        <div class="amount-underline expense"></div>
                    </div>
                    <div class="error-message" id="amountError" role="alert" aria-live="polite"></div>
                </section>

                <!-- Category Selection -->
                <section class="category-section">
                    <h2 class="section-title">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù</h2>
                    <div class="category-grid" role="group" aria-label="Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù" aria-describedby="categoryError">
                        <!-- Expense Categories -->
                        <div class="category-group expense-categories">
                            <button type="button" class="category-item" data-category="food" aria-pressed="false">
                                <span class="category-icon">üçΩÔ∏è</span>
                                <span class="category-label">ÏãùÎπÑ</span>
                            </button>
                            <button type="button" class="category-item" data-category="transport" aria-pressed="false">
                                <span class="category-icon">üöó</span>
                                <span class="category-label">ÍµêÌÜµ</span>
                            </button>
                            <button type="button" class="category-item" data-category="shopping" aria-pressed="false">
                                <span class="category-icon">üõí</span>
                                <span class="category-label">ÏáºÌïë</span>
                            </button>
                            <button type="button" class="category-item" data-category="bills" aria-pressed="false">
                                <span class="category-icon">üìÑ</span>
                                <span class="category-label">Í≥µÍ≥ºÍ∏à</span>
                            </button>
                            <button type="button" class="category-item" data-category="entertainment" aria-pressed="false">
                                <span class="category-icon">üé™</span>
                                <span class="category-label">Ïò§ÎùΩ</span>
                            </button>
                            <button type="button" class="category-item" data-category="healthcare" aria-pressed="false">
                                <span class="category-icon">üè•</span>
                                <span class="category-label">ÏùòÎ£å</span>
                            </button>
                            <button type="button" class="category-item" data-category="education" aria-pressed="false">
                                <span class="category-icon">üìö</span>
                                <span class="category-label">ÍµêÏú°</span>
                            </button>
                            <button type="button" class="category-item" data-category="other-expense" aria-pressed="false">
                                <span class="category-icon">üè∑Ô∏è</span>
                                <span class="category-label">Í∏∞ÌÉÄ</span>
                            </button>
                        </div>

                        <!-- Income Categories (hidden by default) -->
                        <div class="category-group income-categories" hidden>
                            <button type="button" class="category-item" data-category="salary" aria-pressed="false">
                                <span class="category-icon">üíº</span>
                                <span class="category-label">Í∏âÏó¨</span>
                            </button>
                            <button type="button" class="category-item" data-category="freelance" aria-pressed="false">
                                <span class="category-icon">üíª</span>
                                <span class="category-label">Î∂ÄÏóÖ</span>
                            </button>
                            <button type="button" class="category-item" data-category="investment" aria-pressed="false">
                                <span class="category-icon">üìà</span>
                                <span class="category-label">Ìà¨Ïûê</span>
                            </button>
                            <button type="button" class="category-item" data-category="gift" aria-pressed="false">
                                <span class="category-icon">üéÅ</span>
                                <span class="category-label">Ïö©Îèà</span>
                            </button>
                            <button type="button" class="category-item" data-category="refund" aria-pressed="false">
                                <span class="category-icon">üí∞</span>
                                <span class="category-label">ÌôòÍ∏â</span>
                            </button>
                            <button type="button" class="category-item" data-category="bonus" aria-pressed="false">
                                <span class="category-icon">üéä</span>
                                <span class="category-label">Î≥¥ÎÑàÏä§</span>
                            </button>
                            <button type="button" class="category-item" data-category="other-income" aria-pressed="false">
                                <span class="category-icon">üí∏</span>
                                <span class="category-label">Í∏∞ÌÉÄ</span>
                            </button>
                        </div>
                    </div>
                    <div class="error-message" id="categoryError" role="alert" aria-live="polite"></div>
                </section>

                <!-- Date Selection -->
                <section class="date-section">
                    <h2 class="section-title">ÎÇ†Ïßú ÏÑ†ÌÉù</h2>
                    <div class="date-input-wrapper">
                        <input 
                            type="date" 
                            id="dateInput" 
                            class="date-input" 
                            aria-label="Í±∞Îûò ÎÇ†Ïßú"
                            aria-describedby="dateError"
                            aria-required="true"
                        >
                        <span class="icon icon-sm calendar-icon" aria-hidden="true">
                            <svg aria-hidden="true">
                                <use xlink:href="#rabbit-info"></use>
                            </svg>
                        </span>
                    </div>
                    <div class="error-message" id="dateError" role="alert" aria-live="polite"></div>
                </section>

                <!-- Description Input -->
                <section class="description-section">
                    <h2 class="section-title">ÏÉÅÏÑ∏ ÎÇ¥Ïö© (ÏÑ†ÌÉùÏÇ¨Ìï≠)</h2>
                    <div class="description-wrapper">
                        <textarea 
                            id="descriptionInput" 
                            class="description-input" 
                            placeholder="Í±∞ÎûòÏóê ÎåÄÌïú Î©îÎ™®Î•º ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî (Ïòà: Ï†êÏã¨ ÏãùÏÇ¨, ÎßàÌä∏ Ïû•Î≥¥Í∏∞)"
                            maxlength="200"
                            rows="3"
                            aria-label="Í±∞Îûò ÏÉÅÏÑ∏ ÎÇ¥Ïö©"
                            aria-describedby="descriptionCounter"
                        ></textarea>
                        <div class="character-counter">
                            <span id="descriptionCounter">0/200</span>
                        </div>
                    </div>
                </section>

                <!-- Action Buttons -->
                <section class="action-section">
                    <div class="button-group">
                        <button type="button" class="secondary-button btn btn-secondary btn-md" id="cancelButton">
                            <span class="icon icon-sm button-icon">
                                <svg aria-hidden="true">
                                    <use xlink:href="#potato-error"></use>
                                </svg>
                            </span>
                            <span class="button-text">Ï∑®ÏÜå</span>
                        </button>
                        
                        <button type="submit" class="save-button btn btn-primary btn-md" id="saveButton">
                            <span class="icon icon-sm button-icon">
                                <svg aria-hidden="true">
                                    <use xlink:href="#rabbit-success"></use>
                                </svg>
                            </span>
                            <span class="button-text">Ï†ÄÏû•ÌïòÍ∏∞</span>
                        </button>
                    </div>
                </section>

            </form>
        </div>
    </main>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal" role="dialog" aria-labelledby="successTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="success-animation">
                <span class="icon icon-xl success-character">
                    <svg aria-hidden="true">
                        <use xlink:href="#potato-success"></use>
                    </svg>
                </span>
                <span class="icon icon-xl success-character">
                    <svg aria-hidden="true">
                        <use xlink:href="#rabbit-success"></use>
                    </svg>
                </span>
            </div>
            <h2 class="success-title" id="successTitle">Í±∞ÎûòÍ∞Ä Ï†ÄÏû•ÎêòÏóàÏñ¥Ïöî!</h2>
            <p class="success-message">Í∞êÏûêÌÜ†ÎÅº Í∞ÄÍ≥ÑÎ∂ÄÏóê ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§</p>
            <div class="success-actions">
                <button class="success-button primary" id="continueButton">
                    <span class="icon icon-sm button-icon">
                        <svg aria-hidden="true">
                            <use xlink:href="#rabbit-success"></use>
                        </svg>
                    </span>
                    Í≥ÑÏÜç Îì±Î°ùÌïòÍ∏∞
                </button>
                <button class="success-button secondary" id="viewButton">
                    <span class="icon icon-sm button-icon">
                        <svg aria-hidden="true">
                            <use xlink:href="#potato-info"></use>
                        </svg>
                    </span>
                    ÎÇ¥Ïó≠ Î≥¥Í∏∞
                </button>
            </div>
        </div>
    </div>

    <!-- Error Toast -->
    <div class="toast error-toast" id="errorToast" role="alert" aria-live="assertive" aria-hidden="true">
        <div class="toast-content">
            <span class="icon icon-sm toast-icon">
                <svg aria-hidden="true">
                    <use xlink:href="#potato-error"></use>
                </svg>
            </span>
            <span class="toast-message" id="errorToastMessage">Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§</span>
        </div>
        <button class="toast-close" aria-label="ÌÜ†Ïä§Ìä∏ Îã´Í∏∞">‚úï</button>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" aria-hidden="true">
        <div class="loading-spinner">
            <span class="icon icon-md spinner-character icon-loading">
                <svg aria-hidden="true">
                    <use xlink:href="#potato-loading"></use>
                </svg>
            </span>
            <span class="icon icon-md spinner-character icon-loading">
                <svg aria-hidden="true">
                    <use xlink:href="#rabbit-loading"></use>
                </svg>
            </span>
        </div>
        <p class="loading-text">Í±∞ÎûòÎ•º Ï†ÄÏû•ÌïòÍ≥† ÏûàÏñ¥Ïöî...</p>
    </div>

    <!-- JavaScript -->
    <script src="js/icon-helpers.js"></script>
    <script src="js/sprite-animation-helpers.js"></script>
    <script src="js/theme-switcher.js"></script>
    <script src="transaction-form.js"></script>
    
    <!-- PWA Service Worker -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('‚úÖ SW registered: ', registration);
            })
            .catch(registrationError => {
              console.log('‚ùå SW registration failed: ', registrationError);
            });
        });
      }
    </script>
</body>
</html>