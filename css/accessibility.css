/* 접근성 및 성능 개선 CSS */
/* 모든 HTML 파일에서 공통으로 사용되는 접근성 스타일 */

/* === VISUALLY HIDDEN === */
.visually-hidden {
  position: absolute !important;
  width: var(--sr-only-width) !important;
  height: var(--sr-only-height) !important;
  padding: 0 !important;
  margin: var(--sr-only-margin) !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

/* === SKIP TO CONTENT === */
.skip-to-content {
  position: absolute;
  top: var(--skip-link-offset);
  left: var(--skip-link-padding);
  background: var(--color-primary);
  color: var(--color-primary-contrast);
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--radius-md);
  text-decoration: none;
  font-weight: var(--font-weight-semibold);
  z-index: var(--z-index-overlay);
  transition: var(--transition-default);
}

.skip-to-content:focus {
  top: var(--skip-link-padding);
}

/* === FOCUS MANAGEMENT === */
*:focus {
  outline: var(--focus-outline-width) solid var(--color-primary);
  outline-offset: var(--focus-outline-offset);
}

/* 토큰 기반 포커스 스타일 */
.focus-visible,
*:focus-visible {
  outline: var(--focus-outline-width) solid var(--color-primary);
  outline-offset: var(--focus-outline-offset);
  box-shadow: var(--shadow-focus);
  border-radius: var(--radius-sm);
}

/* 인터랙티브 요소 포커스 개선 */
button:focus-visible,
[role="button"]:focus-visible,
input:focus-visible,
textarea:focus-visible,
select:focus-visible,
a:focus-visible {
  outline: var(--focus-outline-width) solid var(--color-primary);
  outline-offset: var(--focus-outline-offset);
  box-shadow: 0 0 0 4px rgba(31, 199, 212, 0.2);
}

/* === HIGH CONTRAST MODE === */
@media (prefers-contrast: high) {
  *:focus,
  *:focus-visible {
    outline: 3px solid currentColor;
    outline-offset: 2px;
  }
  
  button,
  [role="button"],
  input,
  textarea,
  select {
    border: 2px solid currentColor;
  }
}

/* === REDUCED MOTION === */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  .loading-spinner,
  .progress-fill,
  .character-emoji {
    animation: none !important;
    transform: none !important;
  }
}

/* === TOUCH TARGET SIZES === */
/* 모바일 터치 타겟 최소 크기 보장 */
button,
[role="button"],
input[type="checkbox"],
input[type="radio"],
.nav-item,
.action-button,
.category-item,
.transaction-item,
.floating-add-button,
.fab {
  min-height: var(--mobile-tap-target-size);
  min-width: var(--mobile-tap-target-size);
}

/* === COLOR CONTRAST === */
/* 색상 대비 개선 */
.text-low-contrast {
  color: var(--color-text-secondary);
}

@media (prefers-contrast: high) {
  .text-low-contrast {
    color: var(--color-text-primary);
  }
  
  .transaction-category,
  .character-message,
  .empty-state-description {
    color: var(--color-text-primary);
  }
}

/* === SCREEN READER ONLY === */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* === PREFERS REDUCED DATA === */
@media (prefers-reduced-data: reduce) {
  /* 애니메이션 및 트랜지션 비활성화 */
  * {
    animation: none !important;
    transition: none !important;
  }
  
  /* 배경 이미지 제거 */
  .character-greeting,
  .character-dashboard {
    background-image: none !important;
  }
}

/* === PRINT STYLES === */
@media print {
  /* 불필요한 요소 숨기기 */
  .bottom-navigation,
  .floating-add-button,
  .fab,
  .modal-overlay,
  .toast,
  .loading-overlay {
    display: none !important;
  }
  
  /* 색상을 흑백으로 변경 */
  * {
    background: white !important;
    color: black !important;
    box-shadow: none !important;
  }
  
  /* 페이지 브레이크 제어 */
  .transaction-card,
  .summary-card,
  .day-card {
    break-inside: avoid;
  }
  
  .page-header {
    break-after: avoid;
  }
}

/* === DARK MODE === */
@media (prefers-color-scheme: dark) {
  /* 다크 모드에서 포커스 스타일 조정 */
  *:focus-visible {
    box-shadow: 0 0 0 4px rgba(31, 199, 212, 0.3);
  }
  
  /* 다크 모드 텍스트 대비 개선 */
  .transaction-category,
  .character-message {
    color: var(--color-text-secondary);
  }
}

/* === LOADING STATES === */
/* 로딩 상태 접근성 개선 */
.loading-state[aria-hidden="false"] {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-xl);
}

.loading-text {
  margin-top: var(--spacing-md);
  color: var(--color-text-secondary);
  text-align: center;
}

/* === ERROR STATES === */
/* 에러 상태 접근성 개선 */
.error-message[role="alert"] {
  color: var(--color-error);
  font-weight: var(--font-weight-medium);
  margin-top: var(--spacing-xs);
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.error-message::before {
  content: "⚠️";
  font-size: var(--font-size-sm);
}

/* === KEYBOARD NAVIGATION === */
/* 키보드 네비게이션 개선 */
.nav-item:focus,
.action-button:focus,
.transaction-item:focus {
  transform: translateY(-2px);
  box-shadow: var(--shadow-card-hover);
}

/* Tab 순서 개선 */
[tabindex="-1"] {
  outline: none !important;
}

/* === RESPONSIVE TEXT === */
/* 반응형 텍스트 크기 */
@media (max-width: 576px) {
  body {
    font-size: var(--responsive-font-size-md, var(--font-size-md));
  }
  
  .page-title {
    font-size: var(--responsive-font-size-xl, var(--font-size-xl));
  }
  
  .section-title {
    font-size: var(--responsive-font-size-lg, var(--font-size-lg));
  }
}

/* === SAFE AREA === */
/* 아이폰 노치 및 홈 인디케이터 대응 */
.bottom-navigation {
  padding-bottom: calc(var(--spacing-md) + var(--mobile-safe-area-bottom));
}

.page-header {
  padding-top: calc(var(--spacing-md) + var(--mobile-safe-area-top));
}

/* === PERFORMANCE OPTIMIZATIONS === */
/* GPU 가속 활용 */
.character-emoji,
.loading-spinner,
.progress-fill,
.fab,
.floating-add-button {
  will-change: transform;
  transform: translateZ(0);
}

/* CLS Prevention - Reserve space for dynamic content */
.loading-characters {
  min-height: 80px;
}

.progress-container {
  min-height: 20px;
}

/* 스크롤 성능 개선 */
.transaction-list,
.week-grid,
.category-grid {
  contain: layout style paint;
  will-change: scroll-position;
}

/* === HOVER STATES === */
/* 호버 지원 디바이스에서만 호버 효과 적용 */
@media (hover: hover) {
  button:hover,
  [role="button"]:hover,
  .nav-item:hover,
  .action-button:hover,
  .transaction-item:hover {
    transform: translateY(-1px);
    opacity: var(--opacity-hover);
  }
}

/* === TOUCH FEEDBACK === */
/* 터치 디바이스에서 액티브 상태 */
@media (hover: none) {
  button:active,
  [role="button"]:active,
  .nav-item:active,
  .action-button:active {
    transform: scale(0.98);
    opacity: var(--opacity-hover);
  }
}